# Copyright 2020 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#      http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

settings:
  name: bazel
  min_similarity: 0.65
  repos:
    - https://github.com/bazelbuild/bazel

strategies:

  - id: daily-triage
    name: Daily Triage
    dedup: true
    description: >
      Bazel's DevEx triage deam zeroes out this queue once a day. Prioritize:

       * Keeping an open dialog with our users
       * Initial prioritization (does not have to be perfect)
    tactics:
      - issue-needs-initial-routing
      - issue-exceed-slo-p1
      - issue-needs-team-label
      - pr-reviewable

  - id: team-android
    name: Android
    dedup: true
    description: >
      Bazel Android Team's issues and PRs
    tactics:
      - android-issue-needs-triage
      - android-issue-slo-exceeded-p1
      - android-pr-reviewable

  - id: team-configurability
    name: Configurability
    dedup: true
    description: >
      Bazel Configurability Team's issues and PRs
    tactics:
      - configurability-issue-needs-triage
      - configurability-issue-slo-exceeded-p1
      - configurability-pr-reviewable

  - id: team-core
    name: Core
    dedup: true
    description: >
      Bazel Core Team's issues and PRs
    tactics:
      - core-issue-needs-triage
      - core-issue-slo-exceeded-p1
      - core-pr-reviewable
 
  - id: team-front-end
    name: Front End
    dedup: true
    description: >
      Bazel Front End Team's issues and PRs
    tactics:
      - front-end-issue-needs-triage
      - front-end-issue-slo-exceeded-p1
      - front-end-pr-reviewable

  - id: team-macOS
    name: macOS
    dedup: true
    description: >
      Bazel macOS Team's issues and PRs
    tactics:
      - macOS-issue-needs-triage
      - macOS-issue-slo-exceeded-p1
      - macOS-pr-reviewable

  - id: team-Local-Exec
    name: Local-Exec
    dedup: true
    description: >
      Bazel Local Execution Team's issues and PRs
    tactics:
      - local-exec-issue-needs-triage
      - local-exec-issue-slo-exceeded-p1
      - local-exec-pr-reviewable

  - id: team-performance
    name: Performance
    dedup: true
    description: >
      Bazel Performance Team's issues and PRs
    tactics:
      - performance-issue-needs-triage
      - performance-issue-slo-exceeded-p1
      - performance-pr-reviewable

  - id: team-rules
    name: Rules
    dedup: true
    description: >
      Bazel Rules Team's issues and PRs
    tactics:
      - rules-issue-needs-triage
      - rules-issue-slo-exceeded-p1
      - rules-pr-reviewable

  - id: team-xProdOSS
    name: xProdOSS
    dedup: true
    description: >
      Bazel xProdOSS Team's issues and PRs
    tactics:
      - xprodoss-issue-needs-triage
      - xprodoss-issue-slo-exceeded-p1
      - xprodoss-pr-reviewable

  - id: open
    name: All open PR's and Issues that should be considered for repository stats (hidden)
    used_for_statistics: true
    hidden: true
    tactics:
      - open-prs
      # - open-issues

tactics:
  ### Daily Triage ####
  
  issue-needs-initial-routing:
    name: "Needs initial routing"
    resolution: "Add an untriaged, team and type label"
    type: issue
    filters:
      - label: "!P.*"
      - label: "!team-.*"
      - label: "!untriaged"

  issue-exceed-slo-p1:
    name: "P1 bugs, but no updates in 7 days"
    resolution: "Downgrade to P2 or below"
    type: issue
    filters:
      - label: "P1"
      - label: "type: bug"
      - updated: +7d

  pr-reviewable:
    name: "Pull Requests: Review Ready"
    resolution: "Review requests or mark them as WIP"
    type: pull_request
    filters:
      - label: "!WIP"
      - label: "cla: yes"
      # Temporarily workaround inability to track PR eligibility
      - updated: +1d

  issue-needs-team-label:
    name: "Triaged without a teamlabel"
    resolution: "Add a teamlabel"
    type: issue
    filters:
      - label: "!team-.*"
      - label: "!untriaged"

  ### team-Front-End ###
  
  front-end-issue-needs-triage:
    name: "Front End issues needing triage and prioritization"
    resolution: "Remove untriaged label, add priority and type"
    type: issue
    filters:
      - label: "team-Front-End|team-Starlark|team-ExternalDeps"
      - label: "untriaged"

  front-end-issue-slo-exceeded-p1:
    name: "P1 bugs, but no updates in 7 days"
    resolution: "Downgrade to P2 or below"
    type: issue
    filters:
      - label: "team-Front-End|team-Starlark|team-ExternalDeps"
      - label: "P1"
      - label: "type: bug"
      - updated: +7d

  front-end-pr-reviewable:
    name: "Pull Requests: Review Ready"
    resolution: "Review requests or mark them as WIP"
    type: pull_request
    filters:
      - label: "team-Front-End|team-Starlark|team-ExternalDeps"
      - label: "!WIP"
      - label: "cla: yes"
      # Temporarily workaround inability to track PR eligibility
      - updated: +1d

  ### team-Configurability ###
  
  configurability-issue-needs-triage:
    name: "Issues needing triage and prioritization"
    resolution: "Remove untriaged label, add priority and type"
    type: issue
    filters:
      - label: "team-Configurability"
      - label: "untriaged"

  configurability-issue-slo-exceeded-p1:
    name: "P1 bugs, but no updates in 7 days"
    resolution: "Downgrade to P2 or below"
    type: issue
    filters:
      - label: "team-Configurability"
      - label: "P1"
      - label: "type: bug"
      - updated: +7d

  configurability-pr-reviewable:
    name: "Pull Requests: Review Ready"
    resolution: "Review requests or mark them as WIP"
    type: pull_request
    filters:
      - label: "team-Configurability"
      - label: "!WIP"
      - label: "cla: yes"
      # Temporarily workaround inability to track PR eligibility
      - updated: +1d

  ### team-Android ###
  
  android-issue-needs-triage:
    name: "Issues needing triage and prioritization"
    resolution: "Remove untriaged label, add priority and type"
    type: issue
    filters:
      - label: "team-Android"
      - label: "untriaged"

  android-issue-slo-exceeded-p1:
    name: "P1 bugs, but no updates in 7 days"
    resolution: "Downgrade to P2 or below"
    type: issue
    filters:
      - label: "team-Android"
      - label: "P1"
      - label: "type: bug"
      - updated: +7d

  android-pr-reviewable:
    name: "Pull Requests: Review Ready"
    resolution: "Review requests or mark them as WIP"
    type: pull_request
    filters:
      - label: "team-Android"
      - label: "!WIP"
      - label: "cla: yes"
      # Temporarily workaround inability to track PR eligibility
      - updated: +1d

  ### team-macOS ###
  
  macOS-issue-needs-triage:
    name: "Issues needing triage and prioritization"
    resolution: "Remove untriaged label, add priority and type"
    type: issue
    filters:
      - label: "team-Apple|team-macOS"
      - label: "untriaged"

  macOS-issue-slo-exceeded-p1:
    name: "P1 bugs, but no updates in 7 days"
    resolution: "Downgrade to P2 or below"
    type: issue
    filters:
      - label: "team-Apple|team-macOS"
      - label: "P1"
      - label: "type: bug"
      - updated: +7d

  macOS-pr-reviewable:
    name: "Pull Requests: Review Ready"
    resolution: "Review requests or mark them as WIP"
    type: pull_request
    filters:
      - label: "team-Apple|team-macOS"
      - label: "!WIP"
      - label: "cla: yes"
      # Temporarily workaround inability to track PR eligibility
      - updated: +1d

  ### team-Local-Exec ###
  
  local-exec-issue-needs-triage:
    name: "Issues needing triage and prioritization"
    resolution: "Remove untriaged label, add priority and type"
    type: issue
    filters:
      - label: "team-Local-Exec"
      - label: "untriaged"

  local-exec-issue-slo-exceeded-p1:
    name: "P1 bugs, but no updates in 7 days"
    resolution: "Downgrade to P2 or below"
    type: issue
    filters:
      - label: "team-Local-Exec"
      - label: "P1"
      - label: "type: bug"
      - updated: +7d

  local-exec-pr-reviewable:
    name: "Pull Requests: Review Ready"
    resolution: "Review requests or mark them as WIP"
    type: pull_request
    filters:
      - label: "team-Local-Exec"
      - label: "!WIP"
      - label: "cla: yes"
      # Temporarily workaround inability to track PR eligibility
      - updated: +1d

  ### team-XProdOSS ###
  
  xprodoss-issue-needs-triage:
    name: "Front End issues needing triage and prioritization"
    resolution: "Remove untriaged label, add priority and type"
    type: issue
    filters:
      - label: "team-EngProd|team-XProduct|team-Windows"
      - label: "untriaged"

  xprodoss-issue-slo-exceeded-p1:
    name: "P1 bugs, but no updates in 7 days"
    resolution: "Downgrade to P2 or below"
    type: issue
    filters:
      - label: "team-EngProd|team-XProduct|team-Windows"
      - label: "P1"
      - label: "type: bug"
      - updated: +7d

  xprodoss-pr-reviewable:
    name: "Pull Requests: Review Ready"
    resolution: "Review requests or mark them as WIP"
    type: pull_request
    filters:
      - label: "team-EngProd|team-XProduct|team-Windows"
      - label: "!WIP"
      - label: "cla: yes"
      # Temporarily workaround inability to track PR eligibility
      - updated: +1d

  ### team-Performance ###
  
  performance-issue-needs-triage:
    name: "Issues needing triage and prioritization"
    resolution: "Remove untriaged label, add priority and type"
    type: issue
    filters:
      - label: "team-Performance"
      - label: "untriaged"

  performance-issue-slo-exceeded-p1:
    name: "P1 bugs, but no updates in 7 days"
    resolution: "Downgrade to P2 or below"
    type: issue
    filters:
      - label: "team-Performance"
      - label: "P1"
      - label: "type: bug"
      - updated: +7d

  performance-pr-reviewable:
    name: "Pull Requests: Review Ready"
    resolution: "Review requests or mark them as WIP"
    type: pull_request
    filters:
      - label: "team-Performance"
      - label: "!WIP"
      - label: "cla: yes"
      # Temporarily workaround inability to track PR eligibility
      - updated: +1d

  ### team-Core ###
  
  core-issue-needs-triage:
    name: "Issues needing triage and prioritization"
    resolution: "Remove untriaged label, add priority and type"
    type: issue
    filters:
      - label: "team-Core"
      - label: "untriaged"

  core-issue-slo-exceeded-p1:
    name: "P1 bugs, but no updates in 7 days"
    resolution: "Downgrade to P2 or below"
    type: issue
    filters:
      - label: "team-Core"
      - label: "P1"
      - label: "type: bug"
      - updated: +7d

  core-pr-reviewable:
    name: "Pull Requests: Review Ready"
    resolution: "Review requests or mark them as WIP"
    type: pull_request
    filters:
      - label: "team-Core"
      - label: "!WIP"
      - label: "cla: yes"
      # Temporarily workaround inability to track PR eligibility
      - updated: +1d

  ### team-Rules ###
  
  rules-issue-needs-triage:
    name: "Issues needing triage and prioritization"
    resolution: "Remove untriaged label, add priority and type"
    type: issue
    filters:
      - label: "team-Rules-Server|team-Rules-CPP|team-Rules-Java|team-Rules-Python"
      - label: "untriaged"

  rules-issue-slo-exceeded-p1:
    name: "P1 bugs, but no updates in 7 days"
    resolution: "Downgrade to P2 or below"
    type: issue
    filters:
      - label: "team-Rules-Server|team-Rules-CPP|team-Rules-Java|team-Rules-Python"
      - label: "P1"
      - label: "type: bug"
      - updated: +7d

  rules-pr-reviewable:
    name: "Pull Requests: Review Ready"
    resolution: "Review requests or mark them as WIP"
    type: pull_request
    filters:
      - label: "team-Rules-Server|team-Rules-CPP|team-Rules-Java|team-Rules-Python"
      - label: "!WIP"
      - label: "cla: yes"
      # Temporarily workaround inability to track PR eligibility
      - updated: +1d

  open-prs:
    name: "Open PRs"
    type: pull_request
    state: open

  # open-issues:
  #   name: "Open Issues"
  #   type: issue
  #   state: open
